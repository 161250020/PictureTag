<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查看标注</title>


    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.bootcss.com/foundation/5.5.3/css/foundation.min.css">
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="https://cdn.bootcss.com/foundation/5.5.3/js/vendor/modernizr.js"></script>
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css">

    <style rel="stylesheet">
        .yuan{
            width: 100px;
            height: 100px;
            background-color: #89f9dc;
            border-radius: 50%;
            border:1px solid #ccc;
        }
        .one,.two{
            width: 50%;
            height: 30px;
            float: left;
            box-sizing: border-box;
        }
    </style>

    <style type="text/css">
        canvas{border:1px solid green;}
    </style>
</head>
<body>
<div class="panel panel-info">
    <!--内容-->
    <div class="panel-body">
        <div class="row" style="height: 2000px">
            <!--左边-->
            <div class="col-md-3" style="background-color: white;box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;height: 70%;" align="center">
                <ul class="no-bullet">
                    <li>
                        <br>
                        <div class="yuan">
                            <br>
                            <i class="fa fa-edit" style="font-size:30px"></i>
                            <br>
                            <b>任务要求</b>
                        </div>
                    </li>
                    <br>
                    <br>
                    <br>

                    <div align="left">
                        <ul class="no-bullet">
                            <li>
                                任务ID：001
                            </li>
                            <br>
                            <li>
                                任务发布者：DEF
                            </li>
                            <br>
                            <li>
                                任务完成者：ABC
                            </li>
                            <br>
                            <li>
                                图片数量：100
                            </li>
                            <br>
                            <li>
                                标注类型：整体标注
                            </li>
                            <br>
                            <li>
                                日期：2018-01-02~2018-01-08
                            </li>
                            <br>
                            <li>
                                其他需求：xxxx
                            </li>
                            <br>
                            <li>
                                积分奖励：130
                            </li>
                            <br>
                            <li>
                                任务完成状态：已完成
                            </li>
                        </ul>
                    </div>

                    <br>
                    <br>

                    <li>
                        <button type="button" class="btn btn-success" style="alignment: center">删除任务</button>
                    </li>
                </ul>
            </div>

            <!--右边-->
            <div class="col-md-9" style="background-color: white;box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;height: 70%;">
                <!--左边-->
                <div class="one">
                    <br>
                    <br>
                    <canvas id="canvas" width="350" height="350"></canvas>
                    <br>
                    <br>
                    <!--按钮组-->
                    <div align="center">
                        <button type="button" class="btn btn-default" onclick="backPage()">上一张</button>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <button type="button" class="btn btn-default" onclick="nextpage()">下一张</button>
                    </div>

                    <br>
                    <br>
                    <!--转到第几张图片的标注-->
                    <div class="one">
                        <input type="text" placeholder="共：100张" style="width: 95%">
                    </div>
                    <div class="two">
                        <i class="fa fa-refresh" style="font-size:25px"></i>
                    </div>
                </div>

                <!--右边-->
                <div class="two" style="height: 95%">
                    <br>
                    <div class="panel panel-default" style="height: 100%;background-color: white">
                        <div class="panel-body" style="height: 100%">
                            <ul class="no-bullet">
                                <div id="content">
                                    图片类别：xxxx<br><br>
                                    主要景物:xxxx<br><br>
                                    主题:xxxx<br><br>
                                    主色调:xxxx<br><br>
                                    备注:xxxx
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<script >
    // 获取 canvas 对象
    var canvas = document.getElementById('canvas');
    // 获取绘图环境
    var ctx = canvas.getContext('2d');
    var last = null;
    var file = document.getElementById('file');

    // 文件对象
    var filedata = null;
    var a=0;
    var src = new Array();
    var arr=new Array();
    var arrid=new Array();
    var names;
    var img=new Image();
    function startmark(){

        var loc = location.href;
        var n1 = loc.length;//地址的总长度
        var n2 = loc.indexOf("=");//取得=号的位置
        var id = decodeURI(loc.substr(n2+1, n1-n2));//从=号后面的内容


        names=id.split(">_<");

        var userid="";
        $.ajax({
            url : "/Servlet",
            type : "POST",
            data :{
                "gData":names[0],
                "action":"receiveTaskContent"
            },
            success: function(data) {

                var pic=JSON.parse(data);
                arr=pic.imageIds;

                for(var i=0;i<arr.length;i++){

                    arrid.push(arr[i]);

                    $.ajax({
                        url : "/Servlet",
                        type : "POST",
                        data :{
                            "gData":arr[i].toString(),
                            "action":"receiveTag"
                        },
                        success: function(data) {

                            var pict=JSON.parse(data);
                            src.push(pict.url);
                            img.src=src[a];
                            img.onload = function() {
                                ctx.drawImage(img, 0, 0,350,350);
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert(XMLHttpRequest.status);
                            alert(XMLHttpRequest.readyState);
                            alert(textStatus);
                        }
                    });

                }


            },
            error: function () {
            }
        });

    }





    function nextpage(){
        a++;
        img.src=src[a];
        img.onload = function() {
            ctx.drawImage(img, 0, 0,350,350);
        }
    }
    function backPage(){
        if(a!=0) {
            a--;
            img.src = src[a];
            img.onload = function () {
                ctx.drawImage(img, 0, 0, 350, 350);
            }
        }
    }

    //保存图片
    function savePicture(){
        //保存图片
        var saveImage = canvas.toDataURL('image/jpg');

        // json
        var selectPoint=document.getElementById("sel");
        var option=selectPoint.options;

        var obj;
        if(option.selectedIndex==0){
            obj={
                "sentids":[
                    0
                ],
                "imgid":arrid[a].toString(),
                "Sentences":[
                    {
                        "tokens":[
                            document.getElementById("nature1").value.toString(),
                            document.getElementById("nature2").value.toString(),
                            document.getElementById("nature3").value.toString(),
                            document.getElementById("nature4").value.toString(),
                            document.getElementById("nature5").value.toString()
                        ],
                        "raw":document.getElementById("nature1").value.toString()+document.getElementById("nature2").value.toString()+document.getElementById("nature3").value.toString()+document.getElementById("nature4").value.toString()+document.getElementById("nature5").value.toString(),
                        "imgid":0,
                        "sentid":0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }

        }
        else if(option.selectedIndex==1){
            obj={
                "sentids":[
                    0
                ],
                "imgid":arrid[a].toString(),
                "Sentences":[
                    {
                        "tokens":[
                            document.getElementById("modern1").value.toString(),
                            document.getElementById("modern2").value.toString(),
                            document.getElementById("modern3").value.toString(),
                            document.getElementById("modern4").value.toString()
                        ],
                        "raw":document.getElementById("modern1").value.toString()+document.getElementById("modern2").value.toString()+document.getElementById("modern3").value.toString()+document.getElementById("modern4").toString(),
                        "imgid":0,
                        "sentid":0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }
        }
        else if(option.selectedIndex==2){
            obj={
                "sentids":[
                    0
                ],
                "imgid":arrid[a].toString(),
                "Sentences":[
                    {
                        "tokens":[
                            document.getElementById("people1").value.toString(),
                            document.getElementById("people2").value.toString(),
                            document.getElementById("people3").value.toString(),
                            document.getElementById("people4").value.toString(),
                            document.getElementById("people5").value.toString(),
                            document.getElementById("people6").value.toString(),
                            document.getElementById("people7").value.toString()
                        ],
                        "raw":document.getElementById("people1").value.toString()+document.getElementById("people2").value.toString()+document.getElementById("people3").value.toString()+document.getElementById("people4").value.toString()+document.getElementById("people5").value.toString()+document.getElementById("people6").value.toString()+document.getElementById("people7").value.toString(),
                        "imgid":0,
                        "sentid":0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }
        }
        else if(option.selectedIndex==3){
            obj={
                "sentids":[
                    0
                ],
                "imgid":arrid[a].toString(),
                "Sentences":[
                    {
                        "tokens":[
                            document.getElementById("wild1").value.toString(),
                            document.getElementById("wild2").value.toString(),
                            document.getElementById("wild3").value.toString(),
                            document.getElementById("wild4").value.toString()

                        ],
                        "raw":document.getElementById("wild1").value.toString()+document.getElementById("wild2").value.toString()+document.getElementById("wild3").value.toString()+document.getElementById("wild4").value.toString(),
                        "imgid":0,
                        "sentid":0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }
        }
        else if(option.selectedIndex==4) {
            obj = {
                "sentids": [
                    0
                ],
                "imgid": arrid[a].toString(),
                "Sentences": [
                    {
                        "tokens": [
                            document.getElementById("life1").value.toString(),
                            document.getElementById("life2").value.toString(),
                            document.getElementById("life3").value.toString(),
                            document.getElementById("life4").value.toString(),
                            document.getElementById("life5").value.toString(),
                            document.getElementById("life6").value.toString()
                        ],
                        "raw": document.getElementById("life1").value.toString() + document.getElementById("life2").value.toString() + document.getElementById("life3").value.toString()+ document.getElementById("life4").value.toString() + document.getElementById("life5").value.toString()+ document.getElementById("life6").value.toString(),
                        "imgid": 0,
                        "sentid": 0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }
        }
        else if(option.selectedIndex==5){
            obj={
                "sentids":[
                    0
                ],
                "imgid":arrid[a].toString(),
                "Sentences":[
                    {
                        "tokens":[
                            document.getElementById("style1").value.toString(),
                            document.getElementById("style2").value.toString(),
                            document.getElementById("style3").value.toString(),
                            document.getElementById("style4").value.toString(),
                            document.getElementById("style5").value.toString()
                        ],
                        "raw":document.getElementById("style1").value.toString()+document.getElementById("style2").value.toString()+document.getElementById("style3").value.toString()+document.getElementById("style4").value.toString()+document.getElementById("style5").value.toString(),
                        "imgid":0,
                        "sentid":0
                    }
                ],
                "url":saveImage.toString(),
                "filename":0,
                "split":"train",
                "flag":true
            }
        }

        var obj_json = JSON.stringify(obj);
        $.ajax({
            url: "/Servlet",
            type: "POST",
            async:true,
            data: {
                "gData": obj_json,
                "action": "modifyTag"
            },
            success: function (data) {
                if(data=="true"){
                    alert("保存成功！");

                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status);
                alert(XMLHttpRequest.readyState);
                alert(textStatus);
            }
        });
    }



    function final_submit(){
        $.ajax({
            url: "/Servlet",
            type: "POST",
            //cache: false,
            //async: false,
            data: {
                "taskId": names[0],
                "userId":names[1],
                "action": "completeTask"
            },
            success: function (data) {
                alert("提交成功！");
                window.location.href="../../tools/tools_index.html";
                location.href="../../tools/tools_index.html?"+"txt="+encodeURI(names[1]);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status);
                alert(XMLHttpRequest.readyState);
                alert(textStatus);
            }
        });
    }
</script>

<script>
    //读取id
    var loc = location.href;
    var n1 = loc.length;//地址的总长度
    var n2 = loc.indexOf("=");//取得=号的位置
    var id = decodeURI(loc.substr(n2+1, n1-n2)).toString();//从=号后面的内容

    alert(id);

</script>

</body>
</html>